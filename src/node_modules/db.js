// var Datastore = require('nedb');
var DatastoreProxy = require('nedb_proxy');
var path = require('path');
var Evt = require('evt');

// 数据库初始化
// var dbPath = require('nw.gui').App.dataPath + '/nedb';
// var dbPath = Evt.getBasePath() + '/Users/life/Library/Application Support/Leanote' + '/nedb';
// nedb2 为了port
var dbPath = Evt.getBasePath() + '/nedb55';
// console.error(dbPath);

// test
if(dbPath.length < 6) {
	var dbPath = '/Users/life/Library/Application Support/Leanote' + '/nedb2';
}

// console.log(dbPath);
// g, 表全局环境
var db = {};
var dbNames = ['users', 'notebooks', 'notes', 'tags', 'images', 'attachs', 'noteHistories', 'g'];
for(var i in dbNames) {
	var name = dbNames[i];
	// var p = path.join(dbPath, name + '.db');
    (function (name) {
        // 这部分非常慢!, 会卡界面
    	// db[name] = new Datastore({ filename: p, autoload: true , onload: function () {
     //        console.log(name + ' is loaded');
     //    }});

        db[name] = new DatastoreProxy(name);

    })(name);
}
module.exports = db; 
console.log('db inited');